# 外部GUIアプリ自動操作・クラッシュ監視ツール

Windowsデスクトップアプリケーションの自動操作とクラッシュ監視を行うPythonツールです。GUI版とバックグラウンド実行版の両方を提供します。

## 🎯 機能

- **外部アプリ起動**: 指定したアプリケーションを自動起動
- **GUI自動操作**: メニュー選択やボタンクリックを自動実行
- **リソース監視**: CPU使用率とメモリ使用量を1秒間隔で監視
- **クラッシュ検出**: プロセスの異常終了を検出して通知
- **ログ記録**: 操作履歴とエラーをログに記録
- **バックグラウンド実行**: GUIなしでバックグラウンドでデバッグ処理を実行

## 📋 要件

- Python 3.7以上
- Windows OS
- 以下のPythonライブラリ:
  - `pywinauto` - GUI自動操作
  - `psutil` - プロセス監視
  - `tkinter` - GUI（Python標準搭載）

## 🚀 セットアップ

### 1. 依存ライブラリのインストール

```bash
pip install -r requirements.txt
```

または個別にインストール:

```bash
pip install pywinauto psutil
```

### 2. ツールの起動

#### GUI版（推奨）
```bash
python debug_tool.py
```

#### バックグラウンド版
```bash
# 直接実行
pythonw background_debug.py

# バッチファイルで実行
start_background.bat

# PowerShellで実行
.\start_background.ps1
```

## 📖 使用方法

### GUI版の基本操作

1. **アプリケーション設定**
   - アプリパス: 対象アプリの実行ファイルパス（例: `notepad.exe`）
   - ウィンドウタイトル: アプリのウィンドウタイトル（例: `Untitled - Notepad`）

2. **監視開始**
   - 「アプリ起動・監視開始」ボタンをクリック
   - アプリが起動し、リソース監視が開始されます

3. **自動操作**
   - 「自動操作開始」ボタンをクリック
   - メモ帳の場合、ファイル・編集・ヘルプメニューの操作を自動実行

4. **バックグラウンド実行**
   - 「バックグラウンド実行」ボタンをクリック
   - GUIなしでバックグラウンドでデバッグ処理を実行

5. **監視停止**
   - 「監視停止」ボタンをクリック
   - アプリが終了し、監視が停止されます

### バックグラウンド版の使用方法

1. **設定ファイルの編集**
   - `debug_config.json`を編集して監視対象を設定

2. **バックグラウンド実行**
   - バッチファイルまたはPowerShellスクリプトで実行

3. **ログの確認**
   - `debug_log.txt`でログを確認
   - PowerShellでリアルタイム監視も可能

詳細は`BACKGROUND_USAGE.md`を参照してください。

### 監視情報

- **CPU使用率**: プロセスのCPU使用率（%）
- **メモリ使用量**: プロセスのメモリ使用量（MB）
- **プロセスID**: 対象プロセスのID

### ログ機能

- 操作履歴がリアルタイムでログに表示
- クラッシュ検出時は🚨マークで強調表示
- 「ログクリア」ボタンでログをクリア

## 🔧 カスタマイズ

### 対象アプリの変更

`controller.py`の`create_notepad_test_operations()`メソッドを参考に、他のアプリ用の操作シーケンスを作成できます。

```python
def create_custom_operations(self) -> list:
    return [
        {'name': 'メニュー選択', 'type': 'menu_select', 'target': 'Menu->Item', 'delay': 1.0},
        {'name': 'ボタンクリック', 'type': 'click', 'target': 'Button Title', 'delay': 1.0},
        {'name': 'テキスト入力', 'type': 'type_text', 'target': 'Edit Box', 'text': 'Hello World', 'delay': 1.0},
    ]
```

### 監視間隔の変更

`monitor.py`の`_monitor_loop()`メソッド内の`time.sleep(1.0)`を変更することで監視間隔を調整できます。

## 📁 ファイル構成

```
debug_tool/
├── debug_tool.py           # GUI版メイン実行ファイル
├── background_debug.py     # バックグラウンド版メイン実行ファイル
├── gui.py                  # GUIモジュール
├── controller.py           # アプリ制御モジュール
├── monitor.py              # プロセス監視モジュール
├── debug_config.json       # バックグラウンド版設定ファイル
├── start_background.bat    # バックグラウンド実行用バッチファイル
├── start_background.ps1    # バックグラウンド実行用PowerShellスクリプト
├── BACKGROUND_USAGE.md     # バックグラウンド版使用方法
├── requirements.txt        # 依存ライブラリ
└── README.md              # このファイル
```

## ⚠️ 注意事項

- 対象アプリはGUIアプリケーションである必要があります
- ウィンドウタイトルやメニュー名は正確に指定してください
- 一部のアプリでは自動操作が正常に動作しない場合があります
- 管理者権限が必要なアプリの場合は、ツールも管理者権限で実行してください

## 🐛 トラブルシューティング

### よくある問題

1. **アプリが起動しない**
   - アプリパスが正しいか確認
   - アプリが存在するか確認

2. **自動操作が動作しない**
   - ウィンドウタイトルが正しいか確認
   - メニュー名やボタン名が正確か確認

3. **監視が開始されない**
   - 必要なライブラリがインストールされているか確認
   - 管理者権限が必要な場合は管理者として実行

## 📝 ライセンス

このツールはMITライセンスの下で公開されています。 