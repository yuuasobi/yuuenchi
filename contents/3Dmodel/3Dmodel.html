<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D model | ã‚†ã†ãˆã‚“ã¡</title>
    <link rel="icon" type="image/png" href="../../source/è¦³è¦§è»Šãƒ•ã‚¡ãƒ“ã‚³ãƒ³.png">
    <link rel="shortcut icon" type="image/png" href="../../source/è¦³è¦§è»Šãƒ•ã‚¡ãƒ“ã‚³ãƒ³.png">
    <link rel="apple-touch-icon" href="../../source/è¦³è¦§è»Šãƒ•ã‚¡ãƒ“ã‚³ãƒ³.png">
    <link rel="stylesheet" href="../../style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="3Dmodel.css">
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
</head>
<body>
    <script src="../../header.js"></script>
    
    <header class="library-header">
        <h1>ğŸ§Š 3D model ğŸ§Š</h1>
    </header>
    
    <div class="container">
        <div class="model-grid">
            <div class="model-card" data-model="../../source/3Dmodel/ã‚µã‚¤ã‚³ãƒ­.glb" data-title="ã‚µã‚¤ã‚³ãƒ­">
                <img src="../../source/3Dmodel/ã‚¿ãƒã‚´.png" alt="ã‚¿ãƒã‚´" class="model-thumb">
                <div class="model-title">ã‚¿ãƒã‚´</div>
            </div>
            <div class="model-card" data-model="../../source/3Dmodel/ã‚µã‚¤ã‚³ãƒ­.glb" data-title="ã‚µã‚¤ã‚³ãƒ­">
                <img src="../../source/3Dmodel/ã‚¹ã‚¿ãƒ¼.png" alt="ã‚¹ã‚¿ãƒ¼" class="model-thumb">
                <div class="model-title">ã‚¹ã‚¿ãƒ¼</div>
            </div>
            <div class="model-card" data-model="../../source/3Dmodel/ã‚µã‚¤ã‚³ãƒ­.glb" data-title="ã‚µã‚¤ã‚³ãƒ­">
                <img src="../../source/3Dmodel/å±±.png" alt="å±±" class="model-thumb">
                <div class="model-title">å±±</div>
            </div>
            <div class="model-card" data-model="../../source/3Dmodel/ã‚µã‚¤ã‚³ãƒ­.glb" data-title="ã‚µã‚¤ã‚³ãƒ­">
                <img src="../../source/3Dmodel/ãƒªãƒ³ã‚°.png" alt="ãƒªãƒ³ã‚°" class="model-thumb">
                <div class="model-title">ãƒªãƒ³ã‚°</div>
            </div>
            <div class="model-card" data-model="../../source/3Dmodel/ã‚µã‚¤ã‚³ãƒ­.glb" data-title="ã‚µã‚¤ã‚³ãƒ­">
                <img src="../../source/3Dmodel/å††æŸ±.png" alt="å††æŸ±" class="model-thumb">
                <div class="model-title">å††æŸ±</div>
            </div>
            <div class="model-card" data-model="../../source/3Dmodel/ã‚µã‚¤ã‚³ãƒ­.glb" data-title="ã‚µã‚¤ã‚³ãƒ­">
                <img src="../../source/3Dmodel/ãƒãƒ¼ãƒˆ.png" alt="ãƒãƒ¼ãƒˆ" class="model-thumb">
                <div class="model-title">ãƒãƒ¼ãƒˆ</div>
            </div>
            <div class="model-card" data-model="../../source/3Dmodel/ã‚µã‚¤ã‚³ãƒ­.glb" data-title="ã‚µã‚¤ã‚³ãƒ­">
                <img src="../../source/3Dmodel/é¢¨èˆ¹.png" alt="é¢¨èˆ¹" class="model-thumb">
                <div class="model-title">é¢¨èˆ¹</div>
            </div>
            <div class="model-card" data-model="../../source/3Dmodel/ã‚µã‚¤ã‚³ãƒ­.glb" data-title="ã‚µã‚¤ã‚³ãƒ­">
                <img src="../../source/3Dmodel/èŒ¶ç¢—.png" alt="èŒ¶ç¢—" class="model-thumb">
                <div class="model-title">èŒ¶ç¢—</div>
            </div>
            <div class="model-card" data-model="../../source/3Dmodel/ã‚µã‚¤ã‚³ãƒ­.glb" data-title="ã‚µã‚¤ã‚³ãƒ­">
                <img src="../../source/3Dmodel/æ°´æ§½.png" alt="æ°´æ§½" class="model-thumb">
                <div class="model-title">æ°´æ§½</div>
            </div>
            <div class="model-card" data-model="../../source/3Dmodel/ã‚µã‚¤ã‚³ãƒ­.glb" data-title="ã‚µã‚¤ã‚³ãƒ­">
                <img src="../../source/3Dmodel/çœ‹æ¿.png" alt="çœ‹æ¿" class="model-thumb">
                <div class="model-title">çœ‹æ¿</div>
            </div>
            <div class="model-card" data-model="../../source/3Dmodel/ã‚µã‚¤ã‚³ãƒ­.glb" data-title="ã‚µã‚¤ã‚³ãƒ­">
                <img src="../../source/3Dmodel/ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼.png" alt="ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼" class="model-thumb">
                <div class="model-title">ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼</div>
            </div>
            <div class="model-card" data-model="../../source/3Dmodel/ã‚µã‚¤ã‚³ãƒ­.glb" data-title="ã‚µã‚¤ã‚³ãƒ­">
                <img src="../../source/3Dmodel/ã‚µã‚¤ã‚³ãƒ­.png" alt="ã‚µã‚¤ã‚³ãƒ­" class="model-thumb">
                <div class="model-title">ã‚µã‚¤ã‚³ãƒ­</div>
            </div>
            <div class="model-card" data-model="../../source/3Dmodel/ã‚µã‚¤ã‚³ãƒ­.glb" data-title="ã‚µã‚¤ã‚³ãƒ­">
                <img src="../../source/3Dmodel/é›ªã ã‚‹ã¾.png" alt="é›ªã ã‚‹ã¾" class="model-thumb">
                <div class="model-title">é›ªã ã‚‹ã¾</div>
            </div>
        </div>
    </div>

    <!-- 3Dãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="modelViewer" class="model-viewer-modal">
        <div class="model-viewer-content">
            <div class="model-viewer-header">
                <h2 id="modelTitle">3Dãƒ¢ãƒ‡ãƒ«ãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼</h2>
                <button class="close-btn" onclick="closeModelViewer()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="modelContainer" class="model-container">
                <div id="loadingMessage" class="loading-message">
                    <i class="fas fa-spinner fa-spin"></i>
                    3Dãƒ¢ãƒ‡ãƒ«ã‚’èª­ã¿è¾¼ã¿ä¸­...
                </div>
            </div>
            <div class="model-controls">
                <button class="control-btn" onclick="resetCamera()">
                    <i class="fas fa-home"></i> ãƒªã‚»ãƒƒãƒˆ
                </button>
                <button id="autoRotateBtn" class="control-btn" onclick="toggleAutoRotate()">
                    <i class="fas fa-sync-alt"></i> è‡ªå‹•å›è»¢
                </button>
            </div>
        </div>
    </div>

    <footer>
        <p>&copy; 2025 ã‚†ã†ãˆã‚“ã¡. All Rights Reserved.</p>
    </footer>

    <script>
        // 3Dãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼é–¢é€£ã®å¤‰æ•°
        let scene, camera, renderer, controls, model;
        let autoRotate = false;

        // ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®èª­ã¿è¾¼ã¿ç¢ºèªã¨ã‚¤ãƒ™ãƒ³ãƒˆè¨­å®š
        function initializeViewer() {
            console.log('Initializing viewer...');
            
            // ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®èª­ã¿è¾¼ã¿ç¢ºèª
            if (typeof THREE === 'undefined') {
                console.error('Three.js not loaded');
                setTimeout(initializeViewer, 100); // 100mså¾Œã«å†è©¦è¡Œ
                return;
            } else {
                console.log('Three.js loaded successfully');
            }
            
            if (typeof THREE.GLTFLoader === 'undefined') {
                console.error('GLTFLoader not loaded');
                setTimeout(initializeViewer, 100); // 100mså¾Œã«å†è©¦è¡Œ
                return;
            } else {
                console.log('GLTFLoader loaded successfully');
            }
            
            if (typeof THREE.OrbitControls === 'undefined') {
                console.error('OrbitControls not loaded');
                setTimeout(initializeViewer, 100); // 100mså¾Œã«å†è©¦è¡Œ
                return;
            } else {
                console.log('OrbitControls loaded successfully');
            }
            
            // ã™ã¹ã¦ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒèª­ã¿è¾¼ã¾ã‚ŒãŸã‚‰ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¨­å®š
            const modelCards = document.querySelectorAll('.model-card');
            modelCards.forEach(card => {
                card.addEventListener('click', function() {
                    const modelPath = this.getAttribute('data-model');
                    const modelTitle = this.getAttribute('data-title');
                    openModelViewer(modelPath, modelTitle);
                });
            });
            console.log('Event listeners attached to model cards');
        }

        // DOMContentLoadedã¨window.onloadã®ä¸¡æ–¹ã§åˆæœŸåŒ–ã‚’è©¦è¡Œ
        document.addEventListener('DOMContentLoaded', initializeViewer);
        window.addEventListener('load', initializeViewer);

        // 3Dãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼ã‚’é–‹ã
        function openModelViewer(modelPath, title) {
            console.log('Opening model viewer for:', modelPath, title);
            document.getElementById('modelTitle').textContent = title;
            document.getElementById('modelViewer').style.display = 'flex';
            document.getElementById('loadingMessage').style.display = 'block';
            
            // Three.jsãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
            if (typeof THREE === 'undefined') {
                console.error('Three.js is not loaded');
                document.getElementById('loadingMessage').innerHTML = 
                    '<i class="fas fa-exclamation-triangle"></i> Three.jsãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ';
                return;
            }
            
            initThreeJS();
            loadModel(modelPath);
        }

        // 3Dãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼ã‚’é–‰ã˜ã‚‹
        function closeModelViewer() {
            document.getElementById('modelViewer').style.display = 'none';
            if (renderer) {
                renderer.dispose();
            }
        }

        // Three.jsã®åˆæœŸåŒ–
        function initThreeJS() {
            console.log('Initializing Three.js...');
            const container = document.getElementById('modelContainer');
            
            try {
                // ã‚·ãƒ¼ãƒ³ã®ä½œæˆ
                scene = new THREE.Scene();
                scene.background = new THREE.Color(0xf0f0f0);
                console.log('Scene created');

                // ã‚«ãƒ¡ãƒ©ã®è¨­å®š
                camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
                camera.position.set(0, 0, 5);
                console.log('Camera created');

                // ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ã®è¨­å®š
                renderer = new THREE.WebGLRenderer({ antialias: true });
                renderer.setSize(container.clientWidth, container.clientHeight);
                renderer.shadowMap.enabled = true;
                renderer.shadowMap.type = THREE.PCFSoftShadowMap;
                console.log('Renderer created');

                // ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã®è¨­å®š
                if (typeof THREE.OrbitControls !== 'undefined') {
                    controls = new THREE.OrbitControls(camera, renderer.domElement);
                    controls.enableDamping = true;
                    controls.dampingFactor = 0.05;
                    controls.autoRotate = autoRotate;
                    console.log('Controls created');
                } else {
                    console.error('OrbitControls not available');
                }

                // ãƒ©ã‚¤ãƒˆã®è¿½åŠ 
                const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
                scene.add(ambientLight);

                const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
                directionalLight.position.set(10, 10, 5);
                directionalLight.castShadow = true;
                scene.add(directionalLight);
                console.log('Lights added');

                // ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ã‚’ã‚³ãƒ³ãƒ†ãƒŠã«è¿½åŠ 
                container.innerHTML = '';
                container.appendChild(renderer.domElement);
                console.log('Renderer added to container');

                // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ—
                function animate() {
                    requestAnimationFrame(animate);
                    if (controls) controls.update();
                    renderer.render(scene, camera);
                }
                animate();
                console.log('Animation loop started');

                // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒªã‚µã‚¤ã‚ºå¯¾å¿œ
                window.addEventListener('resize', onWindowResize);
                
            } catch (error) {
                console.error('Error initializing Three.js:', error);
                document.getElementById('loadingMessage').innerHTML = 
                    '<i class="fas fa-exclamation-triangle"></i> Three.jsã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message;
            }
        }

        // ãƒ¢ãƒ‡ãƒ«ã®èª­ã¿è¾¼ã¿
        function loadModel(modelPath) {
            console.log('Loading model from:', modelPath);
            
            if (typeof THREE.GLTFLoader === 'undefined') {
                console.error('GLTFLoader not available');
                document.getElementById('loadingMessage').innerHTML = 
                    '<i class="fas fa-exclamation-triangle"></i> GLTFLoaderãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ';
                return;
            }
            
            const loader = new THREE.GLTFLoader();
            console.log('GLTFLoader created');
            
            loader.load(
                modelPath,
                function(gltf) {
                    console.log('Model loaded successfully:', gltf);
                    model = gltf.scene;
                    
                    // ãƒ¢ãƒ‡ãƒ«ã®ã‚µã‚¤ã‚ºã‚’èª¿æ•´
                    const box = new THREE.Box3().setFromObject(model);
                    const size = box.getSize(new THREE.Vector3());
                    const maxDim = Math.max(size.x, size.y, size.z);
                    const scale = 2 / maxDim;
                    model.scale.setScalar(scale);
                    console.log('Model scaled:', scale);

                    // ãƒ¢ãƒ‡ãƒ«ã‚’ä¸­å¤®ã«é…ç½®
                    const center = box.getCenter(new THREE.Vector3());
                    model.position.sub(center.multiplyScalar(scale));
                    console.log('Model positioned');

                    scene.add(model);
                    console.log('Model added to scene');
                    document.getElementById('loadingMessage').style.display = 'none';
                },
                function(xhr) {
                    const progress = (xhr.loaded / xhr.total * 100);
                    console.log(progress + '% loaded');
                    document.getElementById('loadingMessage').innerHTML = 
                        '<i class="fas fa-spinner fa-spin"></i> 3Dãƒ¢ãƒ‡ãƒ«ã‚’èª­ã¿è¾¼ã¿ä¸­... ' + Math.round(progress) + '%';
                },
                function(error) {
                    console.error('ãƒ¢ãƒ‡ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
                    document.getElementById('loadingMessage').innerHTML = 
                        '<i class="fas fa-exclamation-triangle"></i> ãƒ¢ãƒ‡ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ<br><small>' + error.message + '</small>';
                }
            );
        }

        // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒªã‚µã‚¤ã‚ºå¯¾å¿œ
        function onWindowResize() {
            const container = document.getElementById('modelContainer');
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        }

        // ã‚«ãƒ¡ãƒ©ãƒªã‚»ãƒƒãƒˆ
        function resetCamera() {
            if (controls) {
                controls.reset();
            }
        }

        // è‡ªå‹•å›è»¢ã®åˆ‡ã‚Šæ›¿ãˆ
        function toggleAutoRotate() {
            autoRotate = !autoRotate;
            const autoRotateBtn = document.getElementById('autoRotateBtn');
            
            if (controls) {
                controls.autoRotate = autoRotate;
            }
            
            // ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹ã‚’è¦–è¦šçš„ã«æ›´æ–°
            if (autoRotate) {
                autoRotateBtn.classList.add('active');
                autoRotateBtn.innerHTML = '<i class="fas fa-sync-alt fa-spin"></i> è‡ªå‹•å›è»¢ON';
            } else {
                autoRotateBtn.classList.remove('active');
                autoRotateBtn.innerHTML = '<i class="fas fa-sync-alt"></i> è‡ªå‹•å›è»¢OFF';
            }
        }

        // ãƒ¢ãƒ¼ãƒ€ãƒ«å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
        document.getElementById('modelViewer').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModelViewer();
            }
        });
    </script>
</body>
</html> 